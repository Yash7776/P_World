{% include "admin_panel/header.html"%}
{% load static %}
<!-- Start Content-->
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card-box table-responsive">
                <h4 class="header-title" style="margin-bottom:20px;">List of Customers</h4>
                <table id="datatable" class="table table-striped table-bordered dt-responsive nowrap"
                    style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                        <tr>
                            <th>Sr. No.</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Mobile</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in cus_obj %}
                        <tr>
                            <td>{{forloop.counter }}</td>
                            <td>{{i.name}}</td>
                            <td>{{i.email}}</td>
                            <td>{{i.mobile_no}}</td>
                            <td>
                                <button class="btn btn-info btn-sm" style="padding: 2px 4px;" data-toggle="modal"
                                    data-target="#myModal" onclick="view_detail('{{i.id}}')">
                                    <i class="fa fa-eye"></i> View
                                </button>
                                <button class="btn btn-danger btn-sm" style="padding: 2px 4px;"
                                    onclick="Del('{{i.id}}')">
                                    <i class="fa fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- end row -->

    <!-- The Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header bg-primary text-white">
                    <h4 class="modal-title mb-0">
                        <i class="fa fa-user-circle"></i> Customer Details
                    </h4>
                </div>
                <!-- Modal body -->
                <div class="modal-body p-4">
                    <div class="container-fluid">
                        <div class="row">
                            <!-- Profile Image Section -->
                            <div class="col-md-4 text-center mb-3">
                                <div class="profile-image-container">
                                    <img src="" alt="Customer Profile" id="profile_image"
                                        class="img-fluid rounded-circle shadow-sm"
                                        style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #f0f0f0;">
                                </div>
                            </div>
                            <!-- Customer Information Section -->
                            <div class="col-md-8">
                                <div class="customer-details">
                                    <div class="detail-row mb-3 pb-2 border-bottom">
                                        <label class="font-weight-bold text-muted mb-1">
                                            <i class="fa fa-user"></i> Full Name
                                        </label>
                                        <p class="mb-0 h5" id="name">-</p>
                                    </div>
                                    <div class="detail-row mb-3 pb-2 border-bottom">
                                        <label class="font-weight-bold text-muted mb-1">
                                            <i class="fa fa-phone"></i> Mobile Number
                                        </label>
                                        <p class="mb-0" id="mob">-</p>
                                    </div>
                                    <div class="detail-row mb-3 pb-2 border-bottom">
                                        <label class="font-weight-bold text-muted mb-1">
                                            <i class="fa fa-envelope"></i> Email Address
                                        </label>
                                        <p class="mb-0" id="email">-</p>
                                    </div>
                                    <div class="detail-row mb-2">
                                        <label class="font-weight-bold text-muted mb-1">
                                            <i class="fa fa-map-marker"></i> Address
                                        </label>
                                        <p class="mb-0" id="address">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                         Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for Modal -->
<style>
    #myModal .modal-content {
        border: none;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    #myModal .modal-header {
        border-radius: 10px 10px 0 0;
        padding: 20px 25px;
    }

    #myModal .modal-body {
        background-color: #fff;
    }

    #myModal .detail-row {
        transition: all 0.3s ease;
    }

    #myModal .detail-row:hover {
        background-color: #f8f9fa;
        padding-left: 10px;
        border-radius: 5px;
    }

    #myModal .detail-row label {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    #myModal .detail-row p {
        font-size: 16px;
        color: #333;
    }

    #myModal #profile_image {
        transition: transform 0.3s ease;
    }

    #myModal #profile_image:hover {
        transform: scale(1.05);
    }

    #myModal .modal-footer {
        border-top: 1px solid #dee2e6;
        padding: 15px 25px;
    }

    .profile-image-container {
        padding: 10px;
    }
</style>

{% include "admin_panel/footer.html"%}

<script>
    // Function of Delete Product
    function Del(id) {
        console.log("delete");
        swal({
            title: "Are you sure?",
            text: "To Delete this Entry!",
            icon: "warning",
            buttons: ["No", "Yes"],
            closeOnClickOutside: false,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        method: "POST",
                        url: "/delete_customer_entry/",
                        data: {
                            'cus_id': id,
                        },
                        success: function (response) {
                            if (response == "deleted") {
                                swal("Entry has been Deleted..!", {
                                    icon: "success",
                                    button: "Ok",
                                    closeOnClickOutside: false,
                                }).then(function () {
                                    location.reload();
                                });
                            }
                        }
                    })
                }
            });
    }

    function view_detail(id) {
        // Show loading state
        $('#myModal .modal-body').html('<div class="text-center p-5"><i class="fa fa-spinner fa-spin fa-3x"></i><p class="mt-3">Loading customer details...</p></div>');

        $.ajax({
            url: "/get_customer_detail/",
            method: "POST",
            data: {
                'id': id,
            },
            success: function (response) {
                // Restore modal content
                $('#myModal .modal-body').html(`
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-4 text-center mb-3">
                            <div class="profile-image-container">
                                <img src="" alt="Customer Profile" id="profile_image" 
                                     class="img-fluid rounded-circle shadow-sm"
                                     style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #f0f0f0;">
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="customer-details">
                                <div class="detail-row mb-3 pb-2 border-bottom">
                                    <label class="font-weight-bold text-muted mb-1">
                                        <i class="fa fa-user"></i> Full Name
                                    </label>
                                    <p class="mb-0 h5" id="name">-</p>
                                </div>
                                <div class="detail-row mb-3 pb-2 border-bottom">
                                    <label class="font-weight-bold text-muted mb-1">
                                        <i class="fa fa-phone"></i> Mobile Number
                                    </label>
                                    <p class="mb-0" id="mob">-</p>
                                </div>
                                <div class="detail-row mb-3 pb-2 border-bottom">
                                    <label class="font-weight-bold text-muted mb-1">
                                        <i class="fa fa-envelope"></i> Email Address
                                    </label>
                                    <p class="mb-0" id="email">-</p>
                                </div>
                                <div class="detail-row mb-2">
                                    <label class="font-weight-bold text-muted mb-1">
                                        <i class="fa fa-map-marker"></i> Address
                                    </label>
                                    <p class="mb-0" id="address">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `);

                // Populate data
                $('#name').text(response['name'] || 'N/A');
                $('#mob').text((response['country_code'] || '') + (response['mobile_no'] ? "-" + response['mobile_no'] : 'N/A'));
                $('#address').text(response['address'] || 'N/A');
                $('#email').text(response['email'] || 'N/A');

                if (response.profile_image && response.profile_image.trim() !== "") {
                    // User uploaded image (MEDIA)
                    $('#profile_image').attr('src', response.profile_image);
                } else {
                    // Default static image
                    $('#profile_image').attr(
                        'src',
                        '{% static "admin/img/profile_image.jpg" %}'
                    );
                }
            },
            error: function () {
                $('#myModal .modal-body').html('<div class="alert alert-danger">Failed to load customer details. Please try again.</div>');
            }
        });
    }
</script>