{% include "admin_panel/header.html"%}
{% load static %}

<!-- Start Content-->
<div class="container-fluid">

    <div class="row">
        <div class="col-12">
            <div class="card-box table-responsive">

                <div id="table_sec">

                    <!-- Heading -->
                    <h4 class="header-title mb-4">
                        List of {{vendor_type}}'s Appointment
                    </h4>

                    <!-- Filters -->
                    <div class="d-flex align-items-end flex-wrap gap-3 mb-4">

                        <div style="margin-right: 15px;">
                            <label for="from_date" class="mb-1">From</label>
                            <input class="form-control" id="from_date" type="date">
                        </div>

                        <div style="margin-right: 15px;">
                            <label for="to_date" class="mb-1">To</label>
                            <input class="form-control" id="to_date" type="date">
                        </div>

                        <div style="margin-right: 15px;">
                            <label for="booking_status" class="mb-1">Status</label>
                            <select id="booking_status" class="form-control">
                                <option value="All">All</option>
                                <option value="Booked">Booked</option>
                                <option value="Cancelled">Cancelled</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>

                        <div style="margin-top: 26px;">
                            <button class="btn btn-dark" onclick="filter_by_date()" style="height: 38px;">Search</button>
                            <button class="btn btn-secondary" onclick="refresh_pg()" style="height: 38px;">Reset</button>
                        </div>

                    </div>
                    <!-- End Filters -->

                    <!-- Table -->
                    <div id="filter_table" class="mt-3">
                        <table id="datatable" class="table table-striped table-bordered dt-responsive nowrap"
                            style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                            <thead>
                                <tr>
                                    <th>Sr. No.</th>
                                    <th>{{vendor_type}}</th>
                                    <th>Customer</th>
                                    <th>Pet</th>
                                    <th>
                                        {% if vendor_type == "Doctor" %}
                                            Appointment
                                        {% else %}
                                            Booking
                                        {% endif %} Date
                                    </th>
                                    <th>Booking For</th>
                                    <th>Service</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for i in obj %}
                                <tr>
                                    <td>{{forloop.counter}}</td>
                                    <td>{{i.vendor_name}}</td>
                                    <td>{{i.customer_name}}</td>
                                    <td>{{i.pet_name}}</td>
                                    <td>{{i.date}} {{i.time}}</td>
                                    <td>{{i.booking_date}} {{i.booking_time}}</td>
                                    <td>{% if i.service %}{{i.service}}{% else %}---{% endif %}</td>
                                    <td>{{i.amount}}</td>
                                    <td>{{i.book_status}}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- End Table -->

                </div>
            </div>
        </div>
    </div>

    <div class="row" id="form_sec"></div>
</div>

{% include "admin_panel/footer.html"%}

<!-- Hide DataTable Search & Show Entries -->
<style>
    #datatable_filter,
    #datatable_length {
        display: none !important;
    }
</style>

<script>
    const today = new Date();
    const first_day = new Date();
    first_day.setDate(first_day.getDate() - (first_day.getDate() - 1));
    document.getElementById("from_date").valueAsDate = first_day;

    var lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 1);
    document.getElementById("to_date").valueAsDate = lastDay;

    function filter_by_date() {
        var status1 = $('#booking_status').val();
        var from_date = $('#from_date').val();
        var to_date = $('#to_date').val();
        var vendor_type = '{{vendor_type}}';

        var form = $("#form_data")[0];
        var data_item = new FormData(form);
        data_item.append('status', status1);
        data_item.append('from_date', from_date);
        data_item.append('to_date', to_date);
        data_item.append('vendor_type', vendor_type);

        if (from_date == '') {
            swal("Caution!", "Please Enter From Date!", "info");
        } else if (to_date == '') {
            swal("Caution!", "Please Enter To Date!", "info");
        } else {
            $.ajax({
                url: '/filter_appointment_page/',
                method: "POST",
                processData: false,
                contentType: false,
                cache: false,
                data: data_item,
                success: function (response) {
                    $('#filter_table').html(response);
                }
            });
        }
    }

    function refresh_pg() {
        location.reload();
    }
</script>