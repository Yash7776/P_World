{% load static %}
{% include 'customer/header.html' %}
<style>
	/* Force dark background immediately */
	body, html {
		background-color: #1a1a1a !important;
		color: #f7f7f7 !important;
	}

	.main-content {
		background-color: #1a1a1a;
		min-height: 100vh;
		padding-bottom: 80px;
	}

	.card {
		background-color: #2c2c2c !important;
		border: 1px solid #5e5e5e;
		color: #f7f7f7;
		padding: 30px;
		border-radius: 8px;
		position: relative;
	}

	/* Headings */
	h3 {
		color: #f7f7f7 !important;
		margin-bottom: 30px;
		text-align: left;
	}

	/* Form inputs dark theme */
	.form-control {
		background-color: #3a3a3a !important;
		border: 1px solid #5e5e5e !important;
		color: #f7f7f7 !important;
		padding: 12px;
		font-size: 16px;
		border-radius: 5px;
	}

	.form-control:focus {
		background-color: #444444 !important;
		border-color: #d9534f !important;
		color: #f7f7f7 !important;
		box-shadow: 0 0 0 0.2rem rgba(217, 83, 79, 0.25);
		outline: none;
	}

	.form-control::placeholder {
		color: #bbb6b6 !important;
	}

	/* Error messages */
	span[id^="errmsg"] {
		color: #ff6b6b;
		font-size: 14px;
		display: block;
		margin-top: 5px;
		text-align: left;
		position: relative;
		margin-left: 0 !important;
	}

	/* Buttons */
	.login-btn {
		background-color: #d9534f;
		border: none;
		color: white;
		padding: 12px 30px;
		font-size: 16px;
		font-weight: bold;
		border-radius: 5px;
		cursor: pointer;
		transition: background-color 0.3s;
		width: 100%;
	}

	.login-btn:hover {
		background-color: #c9302c;
	}

	/* Back button styling - circular */
	.back-btn {
		position: absolute;
		top: 13px;
		right: 0;
		background-color: #d9534f;
		border: none;
		color: white;
		width: 45px;
		height: 45px;
		border-radius: 50%;
		cursor: pointer;
		transition: background-color 0.3s;
		z-index: 10;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.back-btn:hover {
		background-color: #c9302c;
	}

	.back-btn i {
		font-size: 18px;
	}

	/* Toggle password icon */
	.toggle-password {
		position: absolute;
		right: 15px;
		top: 50%;
		transform: translateY(-50%);
		cursor: pointer;
		color: #bbb6b6;
		z-index: 5;
	}

	.toggle-password:hover {
		color: #f7f7f7;
	}

	/* Input wrapper for icons */
	.input-wrapper {
		position: relative;
		margin-bottom: 10px;
	}

	/* Form spacing */
	.form-section {
		margin-bottom: 25px;
	}

	/* Google autocomplete styling */
	@keyframes beginBrowserAutofill{0%{}to{}}
	@keyframes endBrowserAutofill{0%{}to{}}
	.pac-container{background-color:#fff;position:absolute!important;z-index:100000;border-radius:2px;border-top:1px solid #d9d9d9;font-family:Arial,sans-serif;box-shadow:0 2px 6px rgba(0,0,0,0.3);-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden}
	.pac-logo:after{content:"";padding:1px 1px 1px 0;height:18px;box-sizing:border-box;text-align:right;display:block;background-image:url(https://maps.gstatic.com/mapfiles/api-3/images/powered-by-google-on-white3.png);background-position:right;background-repeat:no-repeat;background-size:120px 14px}
	.hdpi.pac-logo:after{background-image:url(https://maps.gstatic.com/mapfiles/api-3/images/powered-by-google-on-white3_hdpi.png)}
	.pac-item{cursor:default;padding:0 4px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;line-height:30px;text-align:left;border-top:1px solid #e6e6e6;font-size:11px;color:#999}
	.pac-item:hover{background-color:#fafafa}
	.pac-item-selected,.pac-item-selected:hover{background-color:#ebf2fe}
	.pac-matched{font-weight:700}
	.pac-item-query{font-size:13px;padding-right:3px;color:#000}
	.pac-icon{width:15px;height:20px;margin-right:7px;margin-top:6px;display:inline-block;vertical-align:top;background-image:url(https://maps.gstatic.com/mapfiles/api-3/images/autocomplete-icons.png);background-size:34px}
	.hdpi .pac-icon{background-image:url(https://maps.gstatic.com/mapfiles/api-3/images/autocomplete-icons_hdpi.png)}
	.pac-icon-search{background-position:-1px -1px}
	.pac-item-selected .pac-icon-search{background-position:-18px -1px}
	.pac-icon-marker{background-position:-1px -161px}
	.pac-item-selected .pac-icon-marker{background-position:-18px -161px}
	.pac-placeholder{color:gray}
	.pac-target-input:-webkit-autofill{animation-name:beginBrowserAutofill}
	.pac-target-input:not(:-webkit-autofill){animation-name:endBrowserAutofill}

	/* Responsive adjustments */
	@media (max-width: 768px) {
		.card {
			padding: 25px 20px;
		}
		
		.back-btn {
			top: 0;
			right: 0;
			width: 40px;
			height: 40px;
		}
		
		.back-btn i {
			font-size: 16px;
		}
	}
</style>

<!-- Start main-content -->
<div class="main-content">
	<div class='container' style='margin-top: 1.5rem;'>
		<div class='row'>
			<div class='col-md-3'></div>
			<div class='col-md-6' style="position: relative;"> 
				<h3>Change Password</h3>
				
				<!-- Back Button - Circular -->
				<button class="back-btn" onclick="window.history.back();" title="Go Back">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
				</button>
				
				<div class='card shadow'>
					
					<!-- Old Password -->
					<div class="form-section">
						<div class="input-wrapper">
							<input type="password" class="form-control" name="old_password" maxlength='16' id="old_password" placeholder="Enter Old Password*" />  
							<i class="fa fa-eye-slash toggle-password" id="toggleOldPassword"></i>
						</div>
						<span id="errmsg1"></span>
					</div>
					
					<!-- New Password -->
					<div class="form-section">
						<div class="input-wrapper">
							<input type="password" class="form-control" name="password" maxlength='16' id="password" placeholder="Enter New Password*" />  
							<i class="fa fa-eye-slash toggle-password" id="togglePassword"></i>
						</div>
						<span id="errmsg2"></span>
					</div>
					
					<!-- Confirm Password -->
					<div class="form-section">
						<div class="input-wrapper">
							<input type="password" class="form-control" name="confirm_password" maxlength='16' id="confirm_password" placeholder="Enter Confirm Password*" />  
							<i class="fa fa-eye-slash toggle-password" id="toggleConfirmPassword"></i>
						</div>
						<span id="errmsg3"></span>
						<span id="errmsg4"></span>
					</div>
					
					<!-- Change Password Button -->
					<button class="login-btn nextBtn btn-danger btn-lg" onclick="Change_Password()">Change Password</button>
				</div> 
			</div>
			<div class='col-md-3'></div>
		</div> 
	</div>
</div>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8iRFBrLfP6JZr35cKPkgz6OE79U2jSJQ&libraries=places"></script>
<script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/choices.min.js"></script>

<script>
	$('#old_password').keyup(function(){
		$('#errmsg1').hide();
	});

	$('#password').keyup(function(){
		$('#errmsg2').hide();
	});
	
	$('#confirm_password').keyup(function(){
		$('#errmsg3').hide();
		$('#errmsg4').hide();
	});
	
	function Change_Password() {
		var old_password = $('#old_password').val();
		var password = $('#password').val();
		var confirm_password = $('#confirm_password').val();
		
		if(old_password == ""){
			$('#errmsg1').html("Please Enter Old Password");
			$('#errmsg1').show();
		} 
		else if(password == ""){
			$('#errmsg2').html("Please Enter New Password");  
			$('#errmsg2').show();
		}
		else if(confirm_password == ""){
			$('#errmsg3').html("Please Enter Confirm Password");
			$('#errmsg3').show();
		}
		else if(password != confirm_password) {
			$('#errmsg4').html("New Password doesn't match the Confirm Password");
			$('#errmsg4').show();
		}
		else {
			$.ajax({
				method: "POST",
				url: "/User_Password_Change/",
				data: {
					'old_password': old_password,
					'new_password': password
				},
				success: function(response){
					if(response.status == '1'){
						swal({
							text: "Password Changed Successfully.",
							icon: 'success',
							title: 'Success',
							button: "OK",
							closeOnClickOutside: false,
						}).then((addcat) => {
							window.location.href = "/Profile/";  
						});
					}
					else {
						swal({
							title: "Error",
							text: response.msg,
							icon: 'error',
							button: 'OK',
							closeOnClickOutside: false,
						});
					}
				}  
			});
		}
	}
	
	// Toggle Old Password visibility
	const toggleOldPassword = document.querySelector('#toggleOldPassword');
	const oldPasswordInput = document.querySelector('#old_password');
	
	toggleOldPassword.addEventListener('click', () => {
		const type = oldPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
		oldPasswordInput.setAttribute('type', type);
		toggleOldPassword.classList.toggle("fa-eye");
		toggleOldPassword.classList.toggle("fa-eye-slash");
	});
	
	// Toggle New Password visibility
	const togglePassword = document.querySelector('#togglePassword');
	const passwordInput = document.querySelector('#password');
	
	togglePassword.addEventListener('click', () => {
		const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
		passwordInput.setAttribute('type', type);
		togglePassword.classList.toggle("fa-eye");
		togglePassword.classList.toggle("fa-eye-slash");
	});
	
	// Toggle Confirm Password visibility
	const toggleConfirmPassword = document.querySelector('#toggleConfirmPassword');
	const confirmPasswordInput = document.querySelector('#confirm_password');
	
	toggleConfirmPassword.addEventListener('click', () => {
		const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
		confirmPasswordInput.setAttribute('type', type);
		toggleConfirmPassword.classList.toggle("fa-eye");
		toggleConfirmPassword.classList.toggle("fa-eye-slash");
	});
</script>

{% include 'customer/footer.html' %}