{% load static %}
{% include 'customer/header.html' %}
<style>
	/* Force dark background immediately */
	body, html {
		background-color: #1a1a1a !important;
		color: #f7f7f7 !important;
	}

	.main-content {
		background-color: #1a1a1a;
		min-height: 100vh;
		padding-bottom: 80px;
	}

	.card {
		background-color: #2c2c2c !important;
		border: 1px solid #5e5e5e;
		color: #f7f7f7;
		padding: 30px;
		border-radius: 8px;
	}

	/* Headings */
	h3 {
		color: #f7f7f7 !important;
		margin-bottom: 15px;
		text-align: left;
	}

	p {
		color: #d5d5d5;
		text-align: left;
		margin-bottom: 30px;
	}

	h4 {
		color: #f7f7f7 !important;
	}

	h4 a {
		color: #d9534f;
		text-decoration: none;
		font-weight: 600;
	}

	h4 a:hover {
		color: #c9302c;
		text-decoration: underline;
	}

	/* Form inputs dark theme */
	.form-control {
		background-color: #3a3a3a !important;
		border: 1px solid #5e5e5e !important;
		color: #f7f7f7 !important;
		padding: 12px;
		font-size: 16px;
		border-radius: 5px;
	}

	.form-control:focus {
		background-color: #444444 !important;
		border-color: #d9534f !important;
		color: #f7f7f7 !important;
		box-shadow: 0 0 0 0.2rem rgba(217, 83, 79, 0.25);
		outline: none;
	}

	.form-control::placeholder {
		color: #bbb6b6 !important;
	}

	/* Error messages */
	span[id^="errmsg"] {
		color: #ff6b6b;
		font-size: 14px;
		display: block;
		margin-top: 5px;
		text-align: left;
	}

	/* Buttons */
	.login-btn {
		background-color: #d9534f;
		border: none;
		color: white;
		padding: 12px 30px;
		font-size: 16px;
		font-weight: bold;
		border-radius: 5px;
		cursor: pointer;
		transition: background-color 0.3s;
		width: 100%;
	}

	.login-btn:hover {
		background-color: #c9302c;
	}

	/* Toggle password icon */
	.toggle-password {
		position: absolute;
		right: 15px;
		top: 50%;
		transform: translateY(-50%);
		cursor: pointer;
		color: #bbb6b6;
		z-index: 5;
	}

	.toggle-password:hover {
		color: #f7f7f7;
	}

	/* Input wrapper for icons */
	.input-wrapper {
		position: relative;
		margin-bottom: 10px;
	}

	/* Form spacing */
	.form-section {
		margin-bottom: 25px;
	}

	/* Responsive adjustments */
	@media (max-width: 768px) {
		.card {
			padding: 25px 20px;
		}
	}
</style>

<!-- Start main-content -->
<div class="main-content">
	<div class='container' style='margin-top: 1.5rem;'>
		<div class='row'>
			<div class='col-md-3'></div>
			<div class='col-md-6'> 
				<h3>Lets Sign You In</h3>
				<p>To Continue, first verify that it's you</p>
				
				<div class='card shadow'>
					<!-- Email -->
					<div class="form-section">
						<input type="email" class="form-control" id="email" required name="email" placeholder="Email Address*">
						<span id="errmsg1"></span>
					</div>
					
					<!-- Password -->
					<div class="form-section">
						<div class="input-wrapper">
							<input type="password" class="form-control" name="password" id="password" placeholder="Enter your Password*" /> 
							<i class="fa fa-eye-slash toggle-password" id="togglePassword"></i>
						</div>
						<span id="errmsg2"></span>
					</div>
					
					<!-- Forgot Password Link -->
					<h4 class="mt-3" style="text-align:right; margin-right:20px;">
						<a href="/forgot_password/">Forgot Password?</a>
					</h4>
					
					<!-- Login Button -->
					<button class="login-btn nextBtn btn-danger btn-lg pull-right" onclick="login()">Login</button>
				</div> 
			</div>
			<div class='col-md-3'></div>
		</div> 
	</div>
</div>
<!-- end main-content -->

<script>
	$('#email').keyup(function(){
		$('#errmsg1').hide();
	});

	$('#password').keyup(function(){
		$('#errmsg2').hide();
	});
	
	function login(){
		var email = document.getElementById('email').value;
		var pswd = document.getElementById('password').value;
		var errmsg1 = document.getElementById('errmsg1');
		var errmsg2 = document.getElementById('errmsg2');
		
		if(email == "" || pswd == null){
			errmsg1.innerHTML = "Please Enter Email Address";
			$('#errmsg1').show();
		}
		else if(!(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email))) {
			errmsg1.innerHTML = "Invalid Email Address...";
			$('#errmsg1').show();
		}
		else if(pswd == "" || pswd == null){
			errmsg2.innerHTML = "Please Enter Password";  
			$('#errmsg2').show();
		}
		else {
			$.ajax({
				method: "POST",
				url: "/login_customer_api/",
				headers: {'X-CSRFToken': getCookie('csrftoken')},
				data: {
					"email": email,
					"password": pswd,
					"token": '',
				},
				success: function(response){
					if(response.status == 200){
						if(response.user_type == 'Doctor'){
							window.location.href = "/doctors_appointment/";
						}
						else if(response.user_type == 'Customer'){
							window.location.href = "/index/";
						} 
						else if(response.user_type == 'Store'){
							window.location.href = "/store_dashboard/";
						}
						else {
							window.location.href = "/bookings/";
						}
					}
					else {
						errmsg2.innerHTML = response.msg;  
						$('#errmsg2').show();
					}
				}  
			});
		}
	}
	
	const togglePassword = document.querySelector('#togglePassword');
	const password = document.querySelector('#password');
	
	togglePassword.addEventListener('click', () => {
		const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
		password.setAttribute('type', type);
		togglePassword.classList.toggle("fa-eye");
		togglePassword.classList.toggle("fa-eye-slash");
	});
</script>

{% include 'customer/footer.html' %}