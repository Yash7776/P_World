{% load static %}
{% include 'customer/header.html' %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-star-rating/4.0.2/css/star-rating.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-star-rating/4.0.2/js/star-rating.min.js"></script>

<style>
    .caption, .clear-rating {
        display: none !important;
    }
    .rating-stars {
        font-size: 20px;
        margin-top: -3rem;
    }
    .rating-disabled .rating-input,
    .rating-disabled .rating-stars {
        cursor: pointer !important;
    }
    p {
        color: #d5d5d5;
    }
    .rating-container .filled-stars {
        color: #EE163B !important;
        text-shadow: none;
    }
    .rating-container {
        height: 2rem;
        width: 8rem;
    }
    .set_services {
        margin-bottom: 0;
        margin-top: 7px;
    }
    #show_img {
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    div.mm-dropdown {
        border: 1px solid #ddd;
        width: 100%;
        border-radius: 3px;
    }
    div.mm-dropdown ul {
        list-style: none;
        padding: 0;
        margin: 0;
        border: 0;
    }
    div.mm-dropdown ul li,
    div.mm-dropdown div.textfirst {
        padding: 5px 15px;
        color: #c1c1c1;
        border-bottom: 1px solid #ddd;
    }
    div.mm-dropdown div.textfirst img.down {
        float: right;
        margin-top: 5px;
    }
    div.mm-dropdown ul li:last-child {
        border-bottom: 0;
    }
    div.mm-dropdown ul li {
        display: none;
        padding-left: 25px;
    }
    div.mm-dropdown ul li.main {
        display: block;
    }
    div.mm-dropdown ul li img {
        width: 20px;
        height: 20px;
    }
    ::-webkit-calendar-picker-indicator {
        filter: invert(6);
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .store-mini-card:hover {
        border-color: #EE163B;
        box-shadow: 0 4px 12px rgba(238, 22, 59, 0.12);
        transform: translateY(-2px);
        transition: all 0.18s ease;
    }

    .store-mini-card .card-body {
        transition: background 0.2s;
    }

    .store-mini-card:hover .card-body {
        background: #fffafbfc;
    }
</style>

<!-- Start main-content -->
<div class="main-content">

    <!-- Section: inner-header -->
    <section class="inner-header layer-overlay overlay-dark-5" style="height: 6.5rem;">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3 class="title text-white" style="margin-top: -2rem;">Product Details</h3>
                </div>
            </div>
        </div>
    </section>

    <section>
        <div class="container">
            <div class="section-content">

                <button class="login-btn nextBtn btn-danger btn-sm" 
                        onclick="window.location.href='/items/'" 
                        style="float: right; margin-top: -4%;" 
                        data-toggle="tooltip" data-placement="top" title="Back">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                </button>

                <div class="row">
                    <div class="product">
                        <!-- Left - Image -->
                        <div class="col-md-5">
                            <div class="class-item1">
                                <div class="thumb">
                                    {% if item_obj.item_image %}
                                        <img class="img-responsive img-fullwidth mb-20" 
                                             src="{{ item_obj.item_image.url }}" 
                                             alt="{{ item_obj.item_name }}" 
                                             style="height: 20rem; object-fit: cover;">
                                    {% else %}
                                        <img class="img-responsive img-fullwidth mb-20" 
                                             src="{% static 'images/no_image.jpg' %}" 
                                             alt="No image available" 
                                             style="height: 20rem; object-fit: cover;">
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Right - Details -->
                        <div class="col-md-7" style="margin-top: 10%;">
                            <div class="product-summary">
                                <h2 class="product-title" style="margin-bottom: 0;">{{ item_obj.item_name }}</h2>
                                <h3 style="margin-top: 0; margin-bottom: 3px;">
                                    {{ item_obj.fk_category.category_name }} ‚Äî {{ item_obj.pet_type }}
                                </h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <h3 class="text-center">Select Stores</h3>
                </div>
                            {% if store_list %}
                <div class="row justify-content-center mt-4">
                    <div class="col-md-8 col-lg-7">

                        {% for entry in store_list %}
                        <div class="card mb-3 shadow-sm store-mini-card"
                            style="border-radius: 12px; overflow: hidden; border: 1px solid #e0e0e0;">

                            <div class="card-body d-flex align-items-center p-3">

                                <!-- Store image (optional) -->
                                {% if entry.store.profile_image %}
                                <div class="me-3 flex-shrink-0">
                                    <img src="{{ entry.store.profile_image.url }}"
                                        alt="{{ entry.store.bussiness_name|default:entry.store.name }}"
                                        class="rounded-circle"
                                        style="width: 60px; height: 60px; object-fit: cover; border: 2px solid #f0f0f0;">
                                </div>
                                {% else %}
                                <div class="me-3 flex-shrink-0">
                                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center"
                                        style="width: 60px; height: 60px; font-size: 1.4rem; color: #aaa;">
                                        üè™
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Main content -->
                                <div class="flex-grow-1">
                                    <h5 class="card-title mb-1" style="font-size: 1.15rem;">
                                        {{ entry.store.bussiness_name|default:entry.store.name|default:"Unnamed Store" }}
                                    </h5>

                                    <div class="d-flex align-items-center mb-1" style="font-size: 0.95rem; color: #555;">
                                        <small>
                                            {{ entry.store.bussiness_address|truncatewords:8|default:entry.store.address|truncatewords:8|default:"‚Äî" }}
                                        </small>
                                    </div>

                                    <!-- Price + Action -->
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <div>
                                            <strong style="color: #EE163B; font-size: 1.3rem;">
                                                ‚Çπ{{ entry.price|floatformat:2 }}
                                            </strong>
                                            {% if entry.price == 0 or not entry.price %}
                                            <small class="text-muted">(Contact store)</small>
                                            {% endif %}
                                        </div>

                                        <a href="#" class="btn btn-sm btn-danger px-3 py-1"
                                        onclick="addToCart({{ item_obj.id }}, {{ entry.store.id }}); return false;">
                                            Add to Cart
                                        </a>
                                    </div>
                                </div>

                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-5 text-muted">
                            <p>No stores are currently selling this product.</p>
                            <small>Check back later or explore similar items.</small>
                        </div>
                        {% endfor %}

                    </div>
                </div>
            {% else %}
                <div class="text-center py-5 text-muted">
                    <p>No stores found for this item yet.</p>
                </div>
            {% endif %}
            </div>
        </div>
    </section>
</div>
{% include 'customer/footer.html' %}
