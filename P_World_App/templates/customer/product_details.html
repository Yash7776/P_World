{% load static %}
{% include 'customer/header.html' %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-star-rating/4.0.2/css/star-rating.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-star-rating/4.0.2/js/star-rating.min.js"></script>
	
  <style>
.caption , .clear-rating {
  display:none!important;
}
.rating-stars{
 font-size:20px;
 margin-top: -3rem;
}
.rating-disabled .rating-input, .rating-disabled .rating-stars{
  cursor:pointer!important; 
}
p{
color: #d5d5d5; 
}
.rating-container .filled-stars { 
    color: #EE163B !important;
    text-shadow:none;
	}
.rating-container {
	height: 2rem;
	width: 8rem;
	}
 .set_services{
    margin-bottom: 0;
    margin-top: 7px;
 }
 
  #show_img{
    background-size: contain;
	background-repeat: no-repeat;
	background-position: center;
  }
	div.mm-dropdown {
  border: 1px solid #ddd;
  width: 100%;
  border-radius: 3px;
}

div.mm-dropdown ul {
  list-style: none;
  padding: 0;
  margin: 0;
  border: 0;
}

div.mm-dropdown ul li,
div.mm-dropdown div.textfirst {
  padding: 0;
  color: #c1c1c1;
  border-bottom: 1px solid #ddd;
  padding: 5px 15px;
}

div.mm-dropdown div.textfirst img.down {
  float: right;
  margin-top: 5px
}

div.mm-dropdown ul li:last-child {
  border-bottom: 0;
}

div.mm-dropdown ul li {
  display: none;
  padding-left: 25px;
}

div.mm-dropdown ul li.main {
  display: block;
}

div.mm-dropdown ul li img {
  width: 20px;
  height: 20px;
}
::-webkit-calendar-picker-indicator {
    filter: invert(6);
	
}
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

</style>
  <!-- Start main-content -->
  <div class="main-content">
    <!-- Section: inner-header -->
    <section class="inner-header  layer-overlay overlay-dark-5" style='height:6.5rem;' >
      <div class="container">
        <!-- Section Content -->
        <!-- <div class="section-content"> -->
          <div class="row"> 
            <div class="col-md-12">
              <h3 class="title text-white" style='margin-top:-2rem;'>Product Details</h3>
            </div>
          </div>
        <!-- </div> -->
      </div>
    </section>

    <section>
      <div class="container">
        <div class="section-content">
		<button class="login-btn nextBtn btn-danger btn-sm" onclick="window.location.href='/items/'" style="float: right;margin-top: -4%;" data-toggle="tooltip" data-placement="top" title="Back" ><i class="fa fa-arrow-left" aria-hidden="true" style="cursor:pointer;"></i></button>
          <div class="row">
            <div class="product">
              <div class="col-md-5">
               <div class="class-item1">
                  <div class="thumb">  
                    <img class="img-responsive img-fullwidth mb-20" {% if item_obj.item_image %} src="{{item_obj.item_image.url}}" {% else %} src="/media/profile_image/no_image.jpg " {% endif %} alt="..." style='height:20rem;'> 
                  </div>
              </div>
              </div>
              <div class="col-md-7">
                <div class="product-summary">
                  <h2 class="product-title"style='margin-bottom:0;'>{{item_obj.item_name}}</h2>
				  <h3 style='margin-top:0;margin-bottom:3px;'> {{item_obj.fk_category.category_name}}-{{item_obj.pet_type}}</h3>
				  <h4 id ="fk_business" data-fk_vendor-id="{{item_obj.fk_vendor.id}}" style='font-weight:bold;margin-bottom:0'>{{ item_obj.fk_vendor.bussiness_name|default:"" }}</h4>
                  <!-- <div class="product_review" style='margin-left: -4px;'>  -->
                    <!-- <input id="input-1" name="input-1" class="rating rating-loading " data-min="0" data-max="5" data-step="0.1" value="4" disabled style="display: none;">   -->
                  <!-- </div> -->
				  <p>
				  {% if distance %}
				  <i class="fa fa-map-marker" style='color: #df314f !important; margin-top:2%;' aria-hidden="true"></i> {{distance}} Km.
				  {% endif %}
				  </p>
				  <!-- <h4 style='font-weight:bold;margin-bottom:0'>Today's Availability :</h4> -->
				  
						  <!-- <p style='margin-left:2rem;margin-bottom:0'><i class="fa fa-clock-o" style='color: #df314f !important;' aria-hidden="true"></i> Shift -  <i class="fa fa-arrow-right" style='color: #df314f !important;' aria-hidden="true"></i>  Shift - 1 - 7:56 AM - 11:00 AM</p> -->
						  <!-- <p style='margin-left:2rem;margin-bottom:0'><i class="fa fa-clock-o" style='color: #df314f !important;' aria-hidden="true"></i> Shift -  <i class="fa fa-arrow-right" style='color: #df314f !important;' aria-hidden="true"></i>  Shift - 1 - 7:56 AM - 11:00 AM</p> -->
						  <!-- <p style='margin-left:2rem;margin-bottom:0'><i class="fa fa-clock-o" style='color: #df314f !important;' aria-hidden="true"></i> Shift -  <i class="fa fa-arrow-right" style='color: #df314f !important;' aria-hidden="true"></i>  Shift - 1 - 7:56 AM - 11:00 AM</p> -->
					  
				  <!-- </br> -->
                  <div class="price"><ins><span class="amount" style="margin-left:-1.5%;">${{item_obj.item_price}}</span></ins></div>
                  <div class="short-description">
                    <h4 style='font-weight:bold;'>Description:</h4>
					 <p>{{item_obj.item_description}}</p>
					 <h4 style='font-weight:bold;'>Location: </h4> 
					 <p>{{item_obj.fk_vendor.map_location}}</p>
                  </div>
					
					  <div class="quantity buttons_added value">
						<span style="font-weight: bold;color: #d5d5d5;font-size:17px;"> Quantity: </span>
						<input type="button" class="minus" value="-" onclick="Item_Minus()" >
						<input type="number" size="4" class="input-text qty text" title="Qty" {% if item_count != None %} value="{{item_count.quantity}}" {% else %} value="1" {% endif %}  name="quantity" min="1" step="1" max="999" style="width: 5%; text-align:center;" id="data">
						<input type="button" class="plus" value="+" onclick="Item_Plus()" >
					  </div>
                  <div class="cart-form-wrapper mt-30">
					
                      {% if request.session.customer_email and request.session.customer_id %} 
						<button class=" btn btn-danger" onclick='AddtoCart()'  {% if item_obj.available_status == False %} disabled {% endif %} id="addtocart">Add to Cart</button> 
					  {% endif %}
					
					  {% if request.session.customer_email and request.session.customer_id  %} {% if item_count != None %} <button class="btn btn-danger" onclick="window.location.href='/checkout'">View Cart</button> {% endif %} {% endif %}
					
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <div class="horizontal-tab product-tab">
                  <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab1" data-toggle="tab">Reviews</a></li> 
                  </ul>
                  <div class="tab-content" style='height: auto;'>
                    <div class="tab-pane fade in active" id="tab1">
						{% if ratings_obj %}
                      <div class="reviews" style='width:90%;margin-left:5rem;max-height:23rem; overflow-y: auto;'> 
                        <ol class="commentlist">
						{% for i in ratings_obj %}
                          <li class="comment">
                            <div class="media "> 
								<div class='row'>
									<div class='col-sm-1 ' style='padding-right: 0;width: 4rem;' >
									 <img class="thumb img-circle media-object float-right" alt="" {% if i.fk_user_sender.profile_image %} src="{{i.fk_user_sender.profile_image.url}}" {% else %} src="/media/profile_image/no_image.jpg " {% endif %} width="35"> 
									  
									</div>
									 <div class='col-sm-6' style='padding-left: 0;'  >  
										<h5 class="media-heading meta mt-10" ><span class="author">{{i.fk_user_sender.name}}</span> â€“ {{i.created_datetime }} :</h5> 
									 </div>
									 <div class='col-sm-2' style='margin-left:17rem;'> 
										<input id="input-1" name="input-1" class="rating rating-loading rating-sm" data-min="0" data-max="5" data-step="0.1" value="{{i.rating}}" style='font-size:10px!important; display: none;' disabled  >  
									 </div>
									 
								</div>    
                                <p style='margin-left:3rem;'>{% if i.comment %} {{i.comment}} {% else %} No Reviews {% endif %}</p>
							</div>
                             
                          </li>
						{% endfor %} 
                        </ol>
					 </div>
						{% else %}
							<h3 style='margin-top: 0;'>Not Available</h3>
                    {% endif %}	 
                    					  
                    </div>
                    
                    
                  </div>
                </div>
              </div>
            </div>
            
          </div>
		  
        </div>
      </div>
    </section>
  </div>
  <!-- end main-content -->
  
  
  
  <script>
	function Item_Plus()
	{
		var quantity = $("#data").val();
		var update_quantity = parseInt(quantity) + 1
		$("#data").val(update_quantity);
		
	}
	function Item_Minus()
	{
		var quantity = $("#data").val();
		if (quantity == 1)
		{
			$("#data").val(quantity);
		}
		else
		{
			var update_quantity = parseInt(quantity) - 1
			$("#data").val(update_quantity);
		}
	}
  
  </script>
	<script>
		
		function AddtoCart()
		{
			var fk_business = document.getElementById('fk_business').getAttribute('data-fk_vendor-id');
			quantity = $("#data").val();
			
			$.ajax({
				method : "POST",
				url : '/AddtoCart/',
				data : {
				"item_id":"{{item_obj.id}}",
				"quantity":quantity,
				"customer_id" : {{request.session.customer_id}},
				"fk_busi": {{item_obj.fk_vendor.id}},
				
				},
				success: function(response){
				 if(response.status == '1' ){
					swal({
					 text : response.msg,
					 icon : 'success',
					 title: 'Success',
					 button: "OK",
					 closeOnClickOutside: false,
				   }).then((addcat)=>{
						   if(addcat){
						    window.location.reload();
						   }
						});
				 }
				 else {
					swal({
						 text : response.msg,
						 icon : 'info',
						 title: 'Information',
						 button: "OK",
						 closeOnClickOutside: false,
					   });
				 }
				}
			});
		}
	
		
	</script>
  
  
  
 <script>
 
    function booking(){
	   var email = '{{request.session.customer_email}}'
	   var c_id = '{{request.session.customer_id}}'
	   if(email && c_id){
	    var services_data = [];
	    let services_id = [];
        $("input[name='services']:checked").each(function () 
        {
		    var temp_data = $(this).val();
			var data = {}
			s_id = parseInt(temp_data.split(",")[0]) 
			servise = temp_data.split(",")[1] 
			amount = parseFloat(temp_data.split(",")[2]).toFixed(2) 
			data = {
			's_id':s_id,
			'service':servise,
			'amount':amount,
			} 
            services_data.push(data);
            services_id.push(s_id);
        });
		if(services_data == ''){
		  swal({
			 text : "You Have To Add servises First.",
			 icon : 'info',
			 title: 'Information',
			 button: "OK",
			 closeOnClickOutside: false,
		   });
		}
		else{ 
		   console.log(services_data)
		   console.log(services_data.length)
		   var string = ''; 
		   var total_amount = 0;
		   for (let i = 0; i < services_data.length; i++) {
		    total_amount = parseFloat(services_data[i].amount) + total_amount
			 
			  string += `<div class='row' style='height: 24px;'>
				<div class='col-sm-6'>
					<h5 style='margin-top: 0;margin-bottom: 0;'>${services_data[i].service}</h5> 
					</div>
					<div class='col-sm-6'>
					<h5 class='text-right' style='margin-top: 0;margin-bottom: 0;'>$ ${services_data[i].amount}   </h5> 
					</div> 
				 </div>`;
		   }
			$('#service_data').html(string);
			$('#services_id').val(services_id);
			$('#total_amount').html(total_amount.toFixed(2));
		   
		    $("#bookingModal").modal("toggle");
		}
	   }
	   else{
	    swal({
		 text : "You Have To Login First.",
		 icon : 'info',
		 title: 'Information',
		 button: "OK",
		 closeOnClickOutside: false,
	   }).then((addcat)=>{
			  window.location.href = '/login/';  
		});
	   }
	   
	}
 </script>
 <script>
	$(function() 
	{
	  // Set
	  var main = $('div.mm-dropdown .textfirst')
	  var li = $('div.mm-dropdown > ul > li.input-option')
	  var inputoption = $("div.mm-dropdown .option")
	  var default_text = 'Select Pet*<img src="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-arrow-down-b-128.png" width="10" height="10" class="down" />';

	  // Animation
	  main.click(function() {
		main.html(default_text);
		li.toggle('fast');
	  });

	  // Insert Data
	  li.click(function() {
		// hide
		li.toggle('fast');
		var livalue = $(this).data('value');
		
		var lihtml = $(this).html();
		
		
		main.html(lihtml);
		inputoption.val(livalue);
	  });
	});
	
	function myFunction(id)
	{	
		$("#pet_id").val(id);
		$("#errmsg1").hide(); 
	}
	
	function close_modal(){
	$("#errmsg1").hide();
	$("#errmsg2").hide();
	$("#errmsg3").hide();
	$("#date").val('');
	$("#time").val(''); 
	}
	function book_service(){
	   var total_amount = $("#total_amount").html();
	   var services_id = $("#services_id").val();
	   var pet_id = $("#pet_id").val();
	   var date = $("#date").val();
	   var time = $("#time").val();
	    
	   if(pet_id == ''){
	    $("#errmsg1").html('Select Your Pet');
	    $("#errmsg1").show();
	   }
	   else if(date == '' ){
	    $("#errmsg2").html('Select Date ');
	    $("#errmsg2").show();
	   }
	   else if(time == '' ){
	    $("#errmsg3").html('Select Time');
	    $("#errmsg3").show();
	   }
	   else{
	     $.ajax({
		    method : "POST",
			url : '/book_doctors_appointment_api/',
			headers : {'X-CSRFToken' : getCookie('csrftoken')},
			data : {
			'doctor' :  '{{user_obj.id}}',
			'client' : '{{request.session.customer_id}}',
			'fk_pet' : pet_id, 
			"booking_time": time,
			"booking_date": date,
			"txn_id": "",
			"amount": total_amount,
			"txn_date": date,
			"txn_time": time,
			"txn_status": "",
			"payment_method_type": "",
			"book_status": "Booked", 
			"services": services_id,
			"vendor_type": "{{user_obj.user_type}}",
			},
			success: function(response){
			 console.log(response)
			 if(response.status == 200){
			    swal({
				 text : response.msg,
				 icon : 'success',
				 title: 'Success',
				 button: "OK",
				 closeOnClickOutside: false,
			   }).then((addcat)=>{
			        window.location.href = '/Show_appointments/';
				});
			 }
			 else {
			    swal({
					 text : response.msg,
					 icon : 'info',
					 title: 'Information',
					 button: "OK",
					 closeOnClickOutside: false,
				   });
			 }
			}
		 });
	   }
	}
	$("#date").mouseup(function(){
	 $("#errmsg2").hide();
	});
	
	$("#time").mouseup(function(){
	 $("#errmsg3").hide();
	});
	
 </script>
  {% include 'customer/footer.html' %}