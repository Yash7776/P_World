{% load static %}
{% include 'customer/header.html' %}
 <style>
  .main-content {
    min-height: calc(100vh - 150px);
}

 
.swal-icon--success:after, .swal-icon--success:before {
 background: #262626 !important;
	 }
.swal-icon--success__hide-corners {
	background: #262626;
}


p{
color: #d5d5d5;
font-weight: bold;
}  
  
  
	.btn-group>.btn.active {
		background-color: #ededed;
	}

	.radio_background1 {
		background-color:  #2c2c2c;
        border-color: #5e5e5e; 
	}

	.btn-group>.btn1.active {
		background-color: #d9534f;
	}

	.btn-group-toggle {
		min-width: 100%;
	}
	 
 </style>
  <!-- Start main-content -->
  <div class="main-content">
    <!-- Section: inner-header -->
      <div class='container text-center'>
			<div class="row" style="margin-top: 1rem;margin-bottom: 1rem;">
				<div class="col-lg-4" ></div>
				<div class="col-lg-4" > 
					<h3 style="color:#fff; margin:0">Availability</h3> 
				</div>
				
				<div class="col-lg-3" >
					<button class="login-btn nextBtn btn-danger btn-sm mr-5" onclick="window.location.href='/doctors_appointment/'"><i class="fa fa-arrow-left" aria-hidden="true" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Back" ></i></button>
				<!-- </div> -->
				<!-- <div class="col-lg-2" style="margin-top: 2.5rem;margin-left: -6rem; color:red;"> -->
					<button class="login-btn nextBtn btn-danger btn-sm" onclick="window.location.href='/doctor_availability/'">Add Availability</button>
				</div>
			</div>
			
		<div class="row">
			<div class="col-md-3"></div>
			<div class="col-md-6">	
				<div class='card shadow text-center' > 
				{% if avalability %} 
					<div class="reminder overflow-auto" id="reminder" style=" max-height:600px !important;  overflow-y: auto;overflow-x: hidden;">
						{% for i in avalability %}
								<div style='border: 3px solid #504e4e;box-shadow: 2px 2px 9px 0px grey; padding: 10px 0px 10px 0px;width: 98%;' > 
									<div class="row ">
										<div class="col-md-10 text-left">
										   <h4 style="margin-left:0.5rem;">Shift - {{i.add_shift}}</h4>
										</div>
										<div class="col-md-2 text-right">
										    <i class="fa fa-edit" aria-hidden="true" onClick="Append_data( '{{i.id}}','{{i.add_shift}}',  '{{i.from_shift|time:'H:i'}}', '{{i.to_shift|date:'H:i'}}',{{i.days}} )" style="cursor:pointer;color:red;margin-right:0.5rem;" data-toggle="tooltip" data-placement="top" title="Edit" ></i> 
											
											 <i class="fa fa-trash" aria-hidden="true" onClick="deleteShift( {{i.id}} )" style="cursor:pointer;color:red;margin-right:1rem;" data-toggle="tooltip" data-placement="top" title="Delete" ></i> 
										</div>
										<div class="col-md-6 text-left">
											 <p style='margin-bottom:0;margin-left:0.5rem;'>From Shift : {{i.from_shift|time:"h:i A"}}</p>  
										</div>
										<div class="col-md-6 text-left"> 
											  <p style='margin-bottom:0;margin-left: 0.5rem;'>TO Shift : {{i.to_shift|time:"h:i A"}}<p>  
										</div>
										<div class="col-md-10 text-left ml-10">  
										     {% for j in i.days %}
											 <a class="btn btn-danger mb-5"  >{{j}}</a>
											 {% endfor %}
										</div>
									</div> 
								</div>
								<br>
						{% endfor %}
					</div>
				{% else %}
					<div class="row" style="margin-top: 2%;">
						<h2>No Availability Available.</h2>
						
					</div>
				{% endif %}
				
		    </div>
		  </div>
		</div>
		 
		     
		 <div class="modal  fade mt-3" id="editModal" role="dialog" data-keyboard="false" data-backdrop="static" style="margin-top:5%;">
				<div class="modal-dialog">
					  
					<div class="modal-content">
						<div class="modal-header" style="background:#404040;" >
						   <h4 class="modal-title" style="color: #fff; margin-top: 0px;margin-bottom: -20px;">Edit Shift Availability</h4>
						  <button type="button" class="close"  style="color: #fff;" data-dismiss="modal" >&times;</button>

						</div>
						<div class="modal-body">
							<input type="hidden" id="shift_id"  value="">
							 <h4 style="text-align: left;"  > Shift - <span id='shift'></span></h4> 
						   <div class="row" >
							
							<div class= "col-md-6" >
							 <label  style="float: left;;color:#dcdbdb;;font-weight:700;" for="from_time" >From</label>
							 <input type="time" id="from_time" class="form-control" name="From" onChange="checkTime('from')">
							 <span id="errmsg1"    style="color:red;  "></span></br>
							</div>
							
							<div class= "col-md-6" >
							<label style="float: left;;color:#dcdbdb;;font-weight:700;" for="to_time" >To</label>
							 <input type="time" id="to_time" class="form-control" name="To" onChange="checkTime('to')">
							 <span id="errmsg2"    style="color:red;  "></span></br>
							</div>
							<div class= "col-md-12" > 
							<label  style="float: left;;color:#dcdbdb;;font-weight:700;"   >Select Days</label>
							</div>
							<div class= "col-md-12" > 
								<div role="group" class="btn-group btn-group-toggle" data-toggle="buttons"> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7;margin-right:1rem;margin-bottom:0.7rem; " >
								  <input autocomplete="off" type="checkbox" name="days" id="Sunday" value="Sunday"  > 
								  Sunday
								  </label> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7; margin-right:1rem;margin-bottom:0.7rem;  " >
								  <input autocomplete="off" type="checkbox" name="days" id="Monday" value="Monday"  > 
								  Monday
								  </label> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7; margin-right:1rem; margin-bottom:0.7rem;  ">
								  <input autocomplete="off" type="checkbox" name="days" id="Tuesday" value="Tuesday"  > 
								  Tuesday
								  </label> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7;margin-right:1rem;margin-bottom:0.7rem;  " >
								  <input autocomplete="off" type="checkbox" name="days" id="Wednesday" value="Wednesday"  > 
								  Wednesday
								  </label> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7; margin-right:1rem;margin-bottom:0.7rem;  " >
								  <input autocomplete="off" type="checkbox" name="days" id="Thursday" value="Thursday"  > 
								  Thursday
								  </label> 
								  <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7; margin-right:1rem;margin-bottom:0.7rem;   ">
								  <input autocomplete="off" type="checkbox" name="days" id="Friday" value="Friday"  > 
								  Friday
								  </label> 
								 <label class="btn btn1 radio_background1  " style="font-size: 16px;color: #f7f7f7; margin-right:1rem;margin-bottom:0.7rem;   ">
								  <input autocomplete="off" type="checkbox" name="days" id="Saturday" value="Saturday"  > 
								  Saturday
								  </label>  
								</div>
								<span id="errmsg3"    style="color:red;  "></span></br>
							</div>
							
						 
						</div> 
						   
						</div>
						<div class="modal-footer" style="margin-top: -1%;">
						  <button type="button" class="btn view-btn-style btn-danger"   onclick="editShift()" >Save</button> 
						</div>
					</div>
			 
				</div>
			</div>
		 
		 
		 
		   </div>
	  </div>
  </div>
  
	
			  
  <!-- end main-content -->
 <script>
	function deleteShift(shift_id)
	{
		
		swal({
			title: "Delete Shift.",
			text: "Do you want to delete this Shift?",
			icon: "warning",
			buttons: ["No", "Yes"],
			html:true,
			className: "swal-back",
			closeOnClickOutside: false,
			dangerMode: true,			
		})		
		.then((willUpdate) => {
			if (willUpdate) {
				$.ajax({
					type:"POST",
					url: "/delete_doctor_shift/",
					headers : {'X-CSRFToken' : getCookie('csrftoken')},
					data: {
						'shift_id': shift_id, 
					},
					success: function (response) 
					{
						if (response.status == 200){
							swal("Shift Deleted Successfully.", {
								icon: "success",
								button: "Ok",
								closeOnClickOutside: false,
								
							})
							.then((addcat)=>{
						   if(addcat){
						    window.location.reload();
						   }
						});
							
						}
						else{
							swal(""+response.msg+"", {
							icon: "error",
							button: "Ok",
							closeOnClickOutside: false,
							});
						}
					}
					
				})
				
			}	
		});
	}
    
  function Append_data(shift_id,add_shift,from_shift,to_shift,days)
	{     
		$('#editModal').modal('show');
		$("#shift_id").val(shift_id);
		$("#shift").html(add_shift); 
		$("#from_time").val(from_shift);
		$("#to_time").val(to_shift);
		for (var i in days){ 
			$("input[name='days']").each(function () 
			{
			if( $(this).val() == days[i] ){  
			 
			 $(this).prop('checked', true);
			 $(this).parent().addClass('active');
			 
			}
			});
		}
		 
	}
	
	  $('#from_time').keyup(function(){
		   $('#errmsg1').html(""); 
		});
		$('#to_time').keyup(function(){
		   $('#errmsg2').html(""); 
		});
		 $('#from_time').mouseup(function(){
		   $('#errmsg1').html(""); 
		});
		$('#to_time').mouseup(function(){
		   $('#errmsg2').html(""); 
		});
		 $(".radio_background1").mouseup(function(){
		   $('#errmsg3').html(""); 
		});
		
		
		
	function editShift(){ 
		  var from_time = $('#from_time').val();
		  var to_time = $('#to_time').val(); 
		  var shift_id = $('#shift_id').val(); 
		  var shift = $('#shift').html(); 
		  var doctor_id = '{{ request.session.customer_id }}'; 
		  
		  var days = [];
			$("input[name='days']:checked").each(function () 
			{
			days.push( $(this).val() );
			});
				
		    if(from_time == "" ){ 
			  $('#errmsg1').html("Enter From Shift."); 
		    } 
			else if(to_time == ""){ 
              $('#errmsg2').html("Enter To Shift."); 
		    }
			else if(from_time == to_time){
			  $('#errmsg2').html("Please Enter valid shift time."); 
			}
			else if(days ==  '' || days == null){ 
              $('#errmsg3').html("Select Days."); 
		    } 
			else
			{
			   
		       $.ajax({
			   method:"POST",
			   url:"/edit_shift_api/", 
			   headers : {'X-CSRFToken' : getCookie('csrftoken')},
			   data:{
			    "id": shift_id,
			    "From_time": from_time,
			    "To_time": to_time,
				"doc_id": doctor_id,
				"Selectd_days":JSON.stringify( days), 
                "Shift_name" :	shift,			
			   },
			   success: function(response){
			    if(response.status ==200){
				 swal({
				   title:"Updated",
					text: "Shift Availability Updated Successfully.",
					icon : 'success',
					button: 'OK',
					closeOnClickOutside: false,
				 }).then((done)=>{
						   if(done){
						   window.location.href='/show_doctor_availability/';
						   }
					});
				   
				}
				else{
				  swal({
				   title:"Error",
					text: response.msg,
					icon : 'error',
					button: 'OK',
					closeOnClickOutside: false,
				 }); 
				}
			   }  
			});
		  
		  }
		} 
	

    function  checkTime(by) {
	var from_time = $('#from_time').val();
    var to_time = $('#to_time').val(); 
	if(from_time == to_time){
	  if(by == "from"){
	    $('#errmsg1').html("Please Enter valid shift time."); 
	    }
	  else {
	    $('#errmsg2').html("Please Enter valid shift time."); 
	  }
	}
	}	
 </script>
  {% include 'customer/footer.html' %}