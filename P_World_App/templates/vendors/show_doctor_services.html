{% load static %}
{% include 'customer/header.html' %}
 <style>
  
 .main-content {
    min-height: calc(100vh - 150px);
}

.swal-icon--success:after, .swal-icon--success:before {
 background: #262626 !important;
	 }
.swal-icon--success__hide-corners {
	background: #262626;
}


p{
color: #d5d5d5;
font-weight: bold;
}  
  
 
 
 </style>
  <!-- Start main-content -->
  <div class="main-content">
    <!-- Section: inner-header -->
      <div class='container text-center'>
			<div class="row" style="margin-top: 1rem;margin-bottom: 1rem;">
				<div class="col-lg-4"  ></div>
				<div class="col-lg-4" >
					{% if services %}
						<h4 style="color:#fff;margin:0;">Manage Services</h4>
					{% endif %}
				</div>
				
				<div class="col-lg-3" >
					<button class="login-btn nextBtn btn-danger btn-sm mr-5" onclick="window.location.href='/doctors_appointment/'"><i class="fa fa-arrow-left" aria-hidden="true" style="cursor:pointer;" data-toggle="tooltip" data-placement="top" title="Back" ></i></button>
				<!-- </div> -->
				<!-- <div class="col-lg-2" > -->
					<button class="login-btn nextBtn btn-danger btn-sm" onclick="window.location.href='/add_services/'">Add Services</button>
				</div>
			</div>
	       <div class='card shadow text-center'  style="display:flex; justify-content:center;"> 
				{% if services %} 
					<div class="reminder overflow-auto" id="reminder" style="width: 60%;margin-top: 20px; max-height:600px !important;  overflow-y: auto;">
						{% for i in services %}
								<div style='border: 3px solid #504e4e;box-shadow: 2px 2px 9px 0px grey; padding: 10px 0px 10px 0px;width: 98%;' > 
									<div class="row ">
										 
										<div class="col-md-10 text-left ">
											 <h4 style='margin-bottom:0; color:#f55151;margin-left: 1rem;'>{{i.title}}</h4>  
											 <p style='margin-bottom:0;margin-left: 1rem;word-break: break-word;'>{{i.description}}</p>  
											 <p style='margin-bottom:0;margin-left: 1rem;color:#9a9a9a;'>{{i.pet_type}}</p>  
										</div>
										<div class="col-md-2 text-right">   
										    <i class="fa fa-edit" aria-hidden="true" id='edit{{i.id}}' onClick="Append_data( '{{i.id}}','{{i.title}}', '{{i.pet_type}}' , '{{i.charges}}' )" data-description = "{{i.description}}" style="cursor:pointer;color:red;margin-right:0.5rem;" data-toggle="tooltip" data-placement="top" title="Edit" ></i> 
											
											 <i class="fa fa-trash" aria-hidden="true" onClick="deleteService( {{i.id}} )" style="cursor:pointer;color:red;margin-right:1rem;" data-toggle="tooltip" data-placement="top" title="Delete" ></i> 
											
											 <p class='mr-10' style='margin-top: 2rem;margin-bottom: 0;'>$ {{i.charges|floatformat:2}}</p> 
										</div>
									</div> 
								</div>
								<br>  
						{% endfor %}
					</div>
				{% else %}
					<div class="row" style="margin-top: 2%;">
						<h2>No Services Available.</h2>
						
					</div>
				{% endif %}
				
		    </div>
		 
		 
		 <div class="modal  fade mt-3" id="editModal" role="dialog" data-keyboard="false" data-backdrop="static" style="margin-top:5%;">
				<div class="modal-dialog">
					  
					<div class="modal-content">
						<div class="modal-header" style="background:#404040;" >
						   <h4 class="modal-title" style="color: #fff; margin-top: 0px;margin-bottom: -20px;">Edit Service</h4>
						  <button type="button" class="close"  style="color: #fff;" data-dismiss="modal" >&times;</button>

						</div>
						<div class="modal-body">
							<input type="hidden" id="service_id" name="service_id" value="">
							 <input type="text" class="form-control" id="title"  name="title" placeholder="Enter Title*">
								<span id="errmsg1"    style="color:red;  "></span></br>
							   
								<input  class="form-control" id="description" rows="3" cols="10" name="Description" placeholder="Enter Description*" maxlength='150'> 
								<span id="errmsg2" style="color:red;"></span></br>
								
								<select class="form-control" placeholder="Pet Type*" id="pet_type" name="pet_type"  >
								<option selected style='background:rgb(50 48 48);color:#bbb6b6;' value = ''>Pet Type*</option>
								{% for obj in pet_obj %}
								<option value="{{obj.name}}" style='background:rgb(50 48 48);color:#bbb6b6;'>{{obj.name}}</option>  
								{% endfor %}
								</select>	
								<span id="errmsg3" style="color:red;"></span>	</br>	
								
								<input type="text" class="form-control" id="charges" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" name="mobile" placeholder=" Enter Charges*" maxlength='7'>
								<span id="errmsg4"    style="color:red;  "></span></br>	
						  
						   
						</div>
						<div class="modal-footer" style="margin-top: -1%;">
						  <button type="button" class="btn view-btn-style btn-danger"   onclick="editService()" >Save</button> 
						</div>
					</div>
			 
				</div>
			</div>
		 
		 
		   </div>
	  </div>
  </div>
  
	
			  
  <!-- end main-content -->
 <script>
	function deleteService(service_id)
	{
		
		swal({
			title: "Delete Service.",
			text: "Do you want to delete this service?",
			icon: "warning",
			buttons: ["No", "Yes"],
			html:true,
			className: "swal-back",
			closeOnClickOutside: false,
			dangerMode: true,			
		})		
		.then((willUpdate) => {
			if (willUpdate) {
				$.ajax({
					type:"POST",
					url: "/Delete_service_manage_api/",
					headers : {'X-CSRFToken' : getCookie('csrftoken')},
					data: {
						'service_id': service_id, 
					},
					success: function (response) 
					{
						if (response.status == 200){
							swal("Service deleted Successfully.", {
								icon: "success",
								button: "Ok",
								closeOnClickOutside: false,
								
							})
							.then((addcat)=>{
						   if(addcat){
						    window.location.reload();
						   }
						});
							
						}
						else{
							swal(""+response.msg+"", {
							icon: "error",
							button: "Ok",
							closeOnClickOutside: false,
							});
						}
					}
					
				})
				
			}	
		});
	}
    
   function Append_data(service_id,title,pet_type,charges)
	{
		$('#editModal').modal('show');
		$("#service_id").val(service_id);
		$("#title").val(title);
		$("#description").val($("#edit"+service_id).data('description'));
		$("#pet_type").val(pet_type);
		$("#charges").val(charges);
		
	}
	
	
	
	function editService(){
		  var title = $('#title').val();
		  var description = $('#description').val();
		  var pet_type = $('#pet_type').val();
		  var charges = $('#charges').val(); 
		  var service_id =  $('#service_id').val(); 
		  
		    if(title == "" ){ 
			  $('#errmsg1').html("Enter title."); 
		    } 
			else if(description == ""){ 
              $('#errmsg2').html("Enter description."); 
		    }
			else if(pet_type == "" || pet_type == null){ 
              $('#errmsg3').html("Select Pet Type."); 
		    }
			else if(charges == ""){ 
              $('#errmsg4').html("Enter Charges."); 
		    }
			else
			{
		       $.ajax({
			   method:"POST",
			   url:"/Edit_service_manage_api/",
			   headers : {'X-CSRFToken' : getCookie('csrftoken')},
			   data:{
			    "service_id": service_id,
			    "title": title,
				"description": description,
				"pet_type": pet_type,
				"charges": charges,
			   },
			   success: function(response){
			    if(response.status ==200){
				 swal({
				   title:"Success",
					text: "Service Updated Successfully.",
					icon : 'success',
					button: 'OK',
					closeOnClickOutside: false,
				 }).then((done)=>{
						   if(done){
						   window.location.reload();
						   }
					});
				   
				}
				else{
				  swal({
				   title:"Error",
					text: response.msg,
					icon : 'error',
					button: 'OK',
					closeOnClickOutside: false,
				 }); 
				}
			   }  
			});
		  
		  }
		} 
		
		
 </script>
  {% include 'customer/footer.html' %}