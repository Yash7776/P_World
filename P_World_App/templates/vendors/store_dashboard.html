{% load static %}
{% include 'customer/header.html' %}
 <style>
  
 
.swal-icon--success:after, .swal-icon--success:before {
 background: #262626 !important;
	 }
.swal-icon--success__hide-corners {
	background: #262626;
}


p{
color: #d5d5d5;
font-weight: bold;
}  
 .caption , .clear-rating {
  display:none!important;
}
.rating-stars{
 font-size:20px;
 margin-top: -3rem;
}
.rating-disabled .rating-input, .rating-disabled .rating-stars{
  cursor:pointer!important; 
}
 
 
.rating-container .filled-stars { 
    color: #EE163B !important;
    text-shadow:none;
	}
.rating-container {
	height: 2rem;
	width: 8rem;
	}
   .radio_background1 {
		background-color: #d98888;
	}

	.btn-group>.btn1.active {
		background-color: #f34444;
	}

	.btn-group-toggle {
		min-width: 100%;
	}
	 
	input[type="radio"]{
		display: none;
	}
	.dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate {
    color: #b5b5b5 !important;
}

  .dignModal{
  margin-left: 0!important;
   }
 </style>
  <!-- Start main-content -->
  <div class="main-content">
    <!-- Section: inner-header -->
      <div class='container text-center'>
			<div class="row mb-10">
				<div class="col-lg-4"></div>
				<div class="col-lg-3" style="margin-bottom: 25px;"> 
					<h3 style="color:#fff;"> <span id='r_title'>Received</span> <span id='a_title'>Approved</span> <span id='c_title'>Cancelled</span> Orders</h3> 
				</div>
				<div class="col-lg-5" style="margin-top: 25px;"> 
					<div role="group" class="btn-group btn-group-toggle " data-toggle="buttons" style="margin-left: 1rem;">
						<label class="btn btn1 mr-5 radio_background1 active" id="Received" style="font-size: 13px;color:#fffafa;font-weight: 600;padding: 2px 6px;border: 1px solid #726666;" onclick="filterData('Pending')"> 
						<input type="radio" name="filter_by"  autocomplete="off"  checked>Received Orders</label>
						<label class="btn btn1 mr-5 radio_background1" id="Approved" style="font-size: 13px;color:#fffafa;font-weight: 600;padding: 2px 6px;border: 1px solid #726666;" onclick="filterData('Approved')">
						<input type="radio" name="filter_by"  autocomplete="off" >Approved Orders</label> 
						<label class="btn btn1 radio_background1" id="Cancel" style="font-size: 13px;color:#fffafa;font-weight: 600;padding: 2px 6px;border: 1px solid #726666;" onclick="filterData('Cancelled')">
						<input type="radio" name="filter_by"  autocomplete="off" >Cancelled Orders</label> 
				    </div>
				</div>
				
			 
			</div>
			<div class = "row mb-40">
			    <div class="col-md-2">
					<h4 for="from_date" style="margin-top: 9px;">From Date :</h4> 
				</div>
				<div class="col-md-2 text-left"> 
					<input type="date" id="from_date" class="form-control" value="{{from_date|date:'Y-m-d'}}" max="{% now 'Y-m-d' %}">
					<span id="errmsg1" style="color:red;"> </span>
				</div>
			    <div class="col-md-2">
					<h4 for="to_date"style="margin-top: 9px;">To Date :</h4> 
				</div>
				<div class="col-md-2 text-left"> 
					<input type="date" id="to_date" class="form-control" value="{{to_date|date:'Y-m-d'}}" max="{% now 'Y-m-d' %}">
					<span id="errmsg2" style="color:red;"> </span>
				</div>
			    <div class="col-md-2">
				   <button class='btn btn-danger' onClick="SearchData()" >Search</button> 
				</div>
				 
			</div>
			<div id='received_order'>
				{{string}}
		    </div>
		 
			</div>
		    
			<div class="modal fade fade mt-3" id="Item_detail_Modal" role="dialog" data-keyboard="false" data-backdrop="static">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header" style="background:grey;" >
								<h4 class="modal-title" style="color: #fff;">Item Detail</h4>
								<button type="button" class="close"  style="color: #fff; margin-top: -4%;" data-dismiss="modal" onclick="clear_data1()" >&times;</button>

							</div>
							<div class="modal-body">
							   <input type="hidden" value="" id="order_id">
							   <div id="item">
									
									
							   </div>
							</div>
								
						</div>
							
					</div>
				  
				</div>
		 
		 
		 
		   </div>
	  </div>
  </div>
  
	
			  
  <!-- end main-content -->
   <script> 
    $("#from_date").mouseup(function(){
	  $("#errmsg1").html("");
	});
    $("#to_date").mouseup(function(){
	  $("#errmsg2").html("");
	});
  
   $("#r_title").show();
   $("#a_title").hide();
   $("#c_title").hide();
   
   function filterData(data){
    if(data == "Pending"){ 
	  $("#r_title").show();
      $("#a_title").hide();
      $("#c_title").hide();
	  sessionStorage.setItem("status", "Pending");
	}
	else if(data == "Approved"){ 
	  $("#r_title").hide();
      $("#a_title").show();
      $("#c_title").hide();
	  sessionStorage.setItem("status", "Approved");
	}
	else{ 
	  $("#c_title").show();
      $("#r_title").hide();
      $("#a_title").hide();
	  sessionStorage.setItem("status", "Cancelled"); 
	}
	$("#from_date").val( "{{from_date|date:'Y-m-d'}}" );
    $("#to_date").val( "{{to_date|date:'Y-m-d'}}" );
	$.ajax({
		method : "POST",
		url : "/filter_vendor_order/",
		data : {
		"status" : data ,
		},
		success: function(response){
		   if(response.status == 1){
		    $("#received_order").html(response.string);
		    $("#from_date").html(response.from_date);
		    $("#to_date").html(response.to_date);
		    }
			else {
			  swal(""+response.msg+"", {
				icon: "error",
				button: "Ok",
				title : "Error",
				closeOnClickOutside: false,
				});
			}
		}
	});
	
   }
   
   function OpenModal(order_id)
	{
		 
		$("#order_id").val(order_id);
		$.ajax({
			type:"POST",
			url: "/Order_Item_Detail/",
			
			data: {
				'order_id': order_id
			},
			success: function (response) 
			{
				if (response.status == '1'){
					$("#item").html(response.response);
					$('#Item_detail_Modal').modal('show');
				}
				else{
					swal(""+response.msg+"", {
					icon: "error",
					button: "Ok",
					closeOnClickOutside: false,
					});
				}
			}
			
		})
	}
		 
  </script>
  
 <script>
	function ChangeStatus(change_status, order_id)
	{
		from_date = $("#from_date").val();
		to_date = $("#to_date").val();
		status = sessionStorage.getItem("status") ;
		swal({
			title: "Change Status",
			text: "Do you want to change this order status?",
			icon: "warning",
			buttons: ["No", "Yes"],
			html:true,
			className: "swal-back",
			closeOnClickOutside: false,
			dangerMode: true,			
		})		
		.then((willUpdate) => {
			if (willUpdate) {
				$.ajax({
					type:"POST",
					url: "/change_order_status/",
					headers : {'X-CSRFToken' : getCookie('csrftoken')},
					data: {
						'change_status': change_status,
						'status': status,
						'order_id': order_id, 
						"from_date" : from_date,
						"to_date" : to_date,
					},
					success: function (response) 
					{
						if (response.status == 1){
							swal(""+response.msg+"", {
								icon: "success",
								button: "Ok",
								closeOnClickOutside: false, 
							})
							.then((addcat)=>{
						   if(addcat){
						     $("#received_order").html(response.string); 
						   }
						});
							
						}
						else{
							swal(""+response.msg+"", {
							icon: "error",
							button: "Ok",
							closeOnClickOutside: false,
							});
						}
					}
					
				})
				
			}	
		});
	}
	
     function SearchData(){
        from_date = $("#from_date").val();
		to_date = $("#to_date").val();
		status = sessionStorage.getItem("status") ; 
		if(from_date== ""){
		  $("#errmsg1").html("Select From Date");
		  $("#errmsg1").show();
		}
		else if(to_date== ""){
		  $("#errmsg2").html("Select to date");
		   $("#errmsg2").show();
		}
		else if(from_date > to_date){ 
		  $("#errmsg1").html("Invalid date... ");
		   $("#errmsg1").show();
		}
		else{
		$.ajax({
			method : "POST",
			url : "/filter_vendor_order_by_date/",
			data : {
			"status" : status ,
			"from_date" : from_date ,
			"to_date" : to_date ,
			},
			success: function(response){
			   if(response.status == 1){
				$("#received_order").html(response.string);
				$("#from_date").html(response.from_date);
				$("#to_date").html(response.to_date);
				}
				else {
				  swal(""+response.msg+"", {
					icon: "error",
					button: "Ok",
					title : "Error",
					closeOnClickOutside: false,
					});
				}
			}
		});
	  }
   }
    
 
 </script>
  {% include 'customer/footer.html' %}